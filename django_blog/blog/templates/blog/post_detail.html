{% extends "blog/base.html" %}
{% load static %}

{% block title %}{{ post.title }} - Django Blog{% endblock %}

{% block content %}
<div class="post-detail">
    <article class="post-full">
        <header class="post-header">
            <h1 class="post-title">{{ post.title }}</h1>
            <div class="post-meta">
                <span class="post-author">By {{ post.author.username }}</span>
                <span class="post-date">Published on {{ post.published_date|date:"F d, Y" }}</span>
                {% if post.updated_date != post.published_date %}
                    <span class="post-updated">Updated on {{ post.updated_date|date:"F d, Y" }}</span>
                {% endif %}
            </div>
        </header>

        <div class="post-content">
            {{ post.content|linebreaks }}
        </div>

        <footer class="post-footer">
            <div class="post-actions">
                <a href="{% url 'post_list' %}" class="btn btn-secondary">Back to Posts</a>
                {% if user.is_authenticated and user == post.author %}
                    <a href="{% url 'post_update' post.pk %}" class="btn btn-warning">Edit Post</a>
                    <a href="{% url 'post_delete' post.pk %}" class="btn btn-danger">Delete Post</a>
                {% endif %}
            </div>
        </footer>
    </article>

    <!-- Comments Section -->
    <section class="comments-section">
        <h3>Comments</h3>
        
        {% if user.is_authenticated %}
        <div class="comment-form">
            <h4>Add a Comment</h4>
            <form method="post" action="{% url 'add_comment' post.pk %}">
                {% csrf_token %}
                <div class="form-group">
                    <textarea name="content" class="form-control" rows="4" placeholder="Write your comment here..." required></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Post Comment</button>
            </form>
        </div>
        {% else %}
        <p><a href="{% url 'login' %}">Login</a> to post a comment.</p>
        {% endif %}

        <div class="comments-list">
            {% for comment in post.comments.all %}
            <div class="comment">
                <div class="comment-header">
                    <strong>{{ comment.author.username }}</strong>
                    <span class="comment-date">{{ comment.created_date|date:"F d, Y" }}</span>
                </div>
                <div class="comment-content">
                    {{ comment.content|linebreaks }}
                </div>
            </div>
            {% empty %}
            <p>No comments yet. Be the first to comment!</p>
            {% endfor %}
        </div>
    </section>
</div>
{% endblock %}
